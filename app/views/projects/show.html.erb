<a href="<%= organization_path(session[:organization_id]) %>">Back</a>

<h1>Project: <%= @project.name %></h1>
<h3>Environment</h3>
<a href="<%= teams_path %>"><button type="button">Define teams</button></a><br>
<a href="<%= tasks_path %>"><button type="button">Define tasks</button></a><br><br>
<a href="<%= potential_allocations_path %>"><button type="button">Define possible allocations</button></a><br><br>

<h3>Schedule</h3>

<% if @cycle_conflicts.count > 0 %>
  <p>The project contains cycles:</p>
  <ul>
      <% @cycle_conflicts.each do |cycle| %>
          <li><%= cycle.map{|id| Task.find(id).title} %></li>
      <% end %>
  </ul>
<% end %>
<% if @capacity_conflicts.count > 0 %>
  <p>The project capacity conflicts:</p>
  <ul>
      <% @capacity_conflicts.each do |capacity| %>
          <li><%= capacity %></li>
      <% end %>
  </ul>
<% end %>
<% if @unallocated_conflicts.count > 0 %>
  <p>The project contains unallocated tasks:<%= @unallocated_conflicts.map{|id| Task.find(id).title} %></p>
<% end %>

<% if @cycle_conflicts.count == 0 and @capacity_conflicts.count == 0 and @unallocated_conflicts.count == 0 %>
  <% if ScheduleAllocation.exists?(:project_id => params[:id]) %>
    <p>Current schedule total project length: <%= ScheduleAllocation.where(:project_id => params[:id]).maximum(:end) %></p>
    <a href="<%= view_schedule_project_path(@project.id) %>"><button type="button">View schedule</button></a>
    <a href="<%= delete_schedule_project_path(@project.id) %>"><button type="button">Delete schedule</button></a>
  <% else %>
    <%= render "set_schedule_form" %>
  <% end %>

  <%= render "compare_algorithms" %>
  <%= render "show_algorithm_comparison" %>
<% else %>
  <p>Please resolve all conflicts to be able to compute schedules</p>
<% end %>

<% if !@messages.nil? %>
  <% @messages.each do |message| %>
    <%= message %><br>
  <% end %>
<% end %>
